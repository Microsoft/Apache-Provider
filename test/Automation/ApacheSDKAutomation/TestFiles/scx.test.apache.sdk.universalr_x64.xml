<varmap assembly="..\Scx.Test.Apache.SDK.ApacheSDKTests.dll" contact="v-litin" dsc="Apache SDK-based BVT" owner="v-litin" xmlns="http://smxinfranet/schemas/mcf/2002/01/varmap">
  <!--SDk Test Cases-->
  
  <var set="0" lvl="1" vid="725203" cid="SSLCertExpirationHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.SSLCertExpirationHealth" dsc="This case if for 725203 and 725204, Verify SSL Certificate Expiration monitor can change to Warning/Error when the expiration time reach to Warning/Error state." permutation="rows">
    <recm key="ActionCmd">
      <val>sh /tmp/createPortforApache.sh -expireSSL; sh /tmp/createSSLCertification.sh</val>
    </recm>
    <recm key="PostCmd">
      <val>sh /tmp/revertapacheconf.sh</val>
    </recm>
    <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.Certificate.Unix.DaysUntilExpiration.Monitor</val>
    </recm>
    <recm key="ExpectedState">
      <val>Warning</val>
    </recm>
  </var>
  
  <var set="0" lvl="1" vid="725204" cid="SSLCertExpirationHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.SSLCertExpirationHealth" dsc="This case if for 725203 and 725204, Verify SSL Certificate Expiration monitor can change to Warning/Error when the expiration time reach to Warning/Error state." permutation="rows">
    <recm key="ActionCmd">
      <val>sh /tmp/createPortforApache.sh -expireSSL</val>
    </recm>
    <recm key="PostCmd">
      <val>sh /tmp/revertapacheconf.sh</val>
    </recm>
    <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.Certificate.Unix.DaysUntilExpiration.Monitor</val>
    </recm>
    <recm key="ExpectedState">
      <val>Error</val>
    </recm>
  </var>
  
  <var set="0" lvl="1" vid="725210" cid="SSLCertExpirationHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.SSLCertExpirationHealth" dsc="Verify Apache HTTP Server Configuration Check status indicate Unhealthy when http.conf file error." permutation="rows">
    <recm key="ActionCmd">
      <val>sh /tmp/breakConfFile.sh</val>
    </recm>
    <recm key="PostCmd">
      <val>sh /tmp/revertConfFile.sh</val>
    </recm>
      <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.ManagedServer.Unix.ConfigurationCheck.Monitor</val>
    </recm>
    <recm key="ExpectedState">
      <val>Error</val>
    </recm>
  </var>
  

  <!--<var set="0" lvl="1" vid="725211" cid="AvailabilityHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.AvailabilityHealth" dsc=" Verify Apache Virtual Host Web Request status Code become Unhealthy when provide invalid credentials to access  Apache HTTP Server." permutation="rows">
    --><!--Don't know how to use a invalid credentials to access Apache HTTP Server.--><!--
    <recm key="ActionCmd">
      <val></val>
    </recm>
    <recm key="PostCmd">
      <val></val>
    </recm>
      <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.VirtualHost.URLProbeStatus.Monitor</val>
    </recm>
    <recm key="ExpectedState">
      <val>Uninitialized</val>
    </recm>
  </var>
  
  <var set="0" lvl="1" vid="725212" cid="AvailabilityHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.AvailabilityHealth" dsc="Verify Apache Virtual Host Web Request status Code become Unhealthy when setting firewall to block the Apache HTTP server port." permutation="rows">
    --><!--Enable firewall need to reboot Linux client, but after reboot it, Apache agent will be removed, need to verify.--><!--
    <recm key="ActionCmd">
      <val></val>
    </recm>
    <recm key="PostCmd">
      <val></val>
    </recm>
      <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.VirtualHost.URLProbeStatus.Monitor</val>
    </recm>
    <recm key="ExpectedState">
      <val>Uninitialized</val>
    </recm>
  </var>-->

  <var set="0" lvl="1" vid="725213" cid="AvailabilityHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.AvailabilityHealth" dsc="Verify Apache Virtual Host Web Request status Code become Unhealthy when stop Apache HTTP server or Virtual Host." permutation="rows">
    <recm key="ActionCmd">
      <val>%stopApacheCmd%</val>
    </recm>
    <recm key="PostCmd">
      <val>%startApacheCmd%</val>
    </recm>
      <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.VirtualHost.URLProbeStatus.Monitor</val>
    </recm>
    <recm key="ExpectedState">
      <val>Uninitialized</val>
    </recm>
  </var>
  
  <var set="0" lvl="1" vid="725214" cid="AvailabilityHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.AvailabilityHealth" dsc="Verify Apache HTTP Server status Monitor become Unhealthy when stop Apache HTTP Server." permutation="rows">
    <recm key="ActionCmd">
      <val>%stopApacheCmd%</val>
    </recm>
    <recm key="PostCmd">
      <val>%startApacheCmd%</val>
    </recm>
      <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.ManagedServer.Unix.ServerStatus.Monitor</val>
    </recm>
    <recm key="ExpectedState">
      <val>Uninitialized</val>
    </recm>
  </var>
  
  <var set="0" lvl="1" vid="725215" cid="AvailabilityHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.AvailabilityHealth" dsc="Verify Apache HTTP Server status Monitor become Unhealthy when remove apache-cimprove package." permutation="rows">
    <recm key="needUninstallApache">
      <val>true</val>
    </recm>
    <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.ManagedServer.Unix.ServerStatus.Monitor</val>
    </recm>
    <recm key="ExpectedState">              
      <val>Uninitialized</val>
    </recm>
  </var>
  
  <!--<var set="0" lvl="1" vid="725216" cid="AvailabilityHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.AvailabilityHealth" dsc="Verify Apache HTTP Server status Monitor become Unhealthy when crashed Apache HTTP Server." permutation="rows">
    --><!--Don't know how to crashed Apache HTTP Server--><!--
    <recm key="ActionCmd">
      <val></val>
    </recm>
    <recm key="PostCmd">
      <val></val>
    </recm>
    <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.ManagedServer.Unix.ServerStatus.Monitor</val>
    </recm>
    <recm key="ExpectedState">              
      <val>Uninitialized</val>
    </recm>
  </var>-->
  
  <!--
  <var set="0" lvl="1" vid="725104" cid="PerformanceWithTwoStateHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.PerformanceWithTwoStateHealth" dsc="Including TC 725104 and 726090: Verify if the Apache HTTPD Server Used Kbytes Memory Monitor state become Error/Warning  while the total memory used by Apache HTTP Server processes was reached the server Error/Warning Threshold value." permutation="rows">
    <recm key="ActionCmd">
      <val>ab -n 1000 -c 100 http://localhost/ </val>
      <val>ab -n 1000 -c 100 http://localhost/ </val>
    </recm>
    <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.ManagedServer.Unix.TotalUsedMemoryKB.Monitor</val>
      <val>Microsoft.ApacheHTTPServer.ManagedServer.Unix.TotalUsedMemoryKB.Monitor</val>
    </recm>
    <recm key="monitorcontext">
      <val>Microsoft.Linux.Universal.OperatingSystem</val>
      <val>Microsoft.Linux.Universal.OperatingSystem</val>
    </recm>
    <recm key="warningThresholdName">
      <val>Warning Threshold</val>
      <val>Warning Threshold</val>
    </recm>
    <recm key="errorThresholdName">
      <val>Error Threshold</val>
      <val>Error Threshold</val>
    </recm>
    <recm key="defaultWarningThreshold">
      <val>262144</val>
      <val>262144</val>
    </recm>
    <recm key="defaultErrorThreshold">
      <val>524288</val>
      <val>524288</val>
    </recm>
    <recm key="overrideWarningThreshold">
      <val>100</val>
      <val>20000</val>
    </recm>
    <recm key="overrideErrorThreshold">
      <val>200</val>
      <val>80000</val>
    </recm>
    <recm key="ExpectedState">              
      <val>Error</val>
      <val>Warning</val>
    </recm>
  </var>
  -->
  <!--
  <var set="0" lvl="0" vid="726119" cid="ApacheVirtualHostPerformanceHealth" cls="Scx.Test.Apache.SDK.ApacheSDKTests.PerformanceHealth" dsc="Verify if the Apache Virtual Host Errors per Minuts-Server Monitor state indicate Unhealy while setting invalid directives in configuration file and generate amount of '500 Internal Server Error'." permutation="rows">
    <recm key="entityname">
      <val>ApacheVirtualHostTotalRequestsPerSecond</val>
      <val>ApacheVirtualHostWebErrorsPerMinuteforClient</val>
    </recm>
    <recm key="action">
      <val>ab -n 1000 http://localhost/ </val>
      <val>ab -n 50000 -c 100 http://localhost/ </val>
    </recm>
    <recm key="monitorname">
      <val>Microsoft.ApacheHTTPServer.VirtualHost.Unix.RequestsPerSecond.Monitor</val>
      <val>Microsoft.ApacheHTTPServer.VirtualHost.Unix.ErrorsPerMinute400.Monitorr</val>
    </recm>
    <recm key="monitorcontext">
      <val>Microsoft.Linux.Universal.OperatingSystem</val>
      <val>Microsoft.Linux.Universal.OperatingSystem</val>
    </recm>
    <recm key="monitortarget">
      <val></val>
      <val></val>
    </recm>
    <recm key="defaultmonitorthreshold">
      <val>100</val>
      <val>80</val>
    </recm>
    <recm key="monitorthreshold">
      <val>10</val>
      <val>10</val>
    </recm>
    <recm key="diagnostics">
      <val></val>
      <val></val>
    </recm>
    <recm key="recoverycmd">
      <val></val>
      <val></val>
    </recm>
  </var>
  -->
  
  <grp cls="Scx.Test.Apache.SDK.ApacheSDKTests.GroupHelper">
    <rec key="hostname">a22p64-ora5-01.scx.com</rec>
    <rec key="superuser">root</rec>
    <rec key="superuserpwd">OpsMgr2007R2</rec>
    <rec key="nonsuperuser">scxuser</rec>
    <rec key="nonsuperuserpwd">scxuser</rec>
    <rec key="omserver"></rec>
    <rec key="omusername">scxsvc</rec>
    <rec key="omdomain">scx</rec>
    <rec key="ompassword">OpsMgr2007R2</rec>
    <!--<rec key="testingoverride">overrideApacheMp.xml</rec>-->
    <rec key="testingoverride">SCXTestOverrideUniversalMP</rec>
    <rec key="cleanupcommand"><![CDATA[/opt/microsoft/scx/bin/uninstall;rm -rf /etc/opt/microsoft/;rm -rf /opt/microsoft;rm -f /tmp/scx-1.0.*;rm -rf /var/opt/microsoft]]></rec>
    <rec key="platformtag">universalr.1.x64</rec>
    <rec key="apacheTag">universal.1.x86_64</rec>
    <rec key="architecture">x64</rec>
    <rec key="logicalprocessors">[0-9]{1}</rec>
    <rec key="isvirtualmachine">Virtual</rec>
    <rec key="physicalprocessors">\s{0}</rec>
    <rec key="targetcomputerclass">Microsoft.Linux.Computer</rec>
    <rec key="targetosclass">Microsoft.Linux.Universal.OperatingSystem</rec>
    <rec key="managementpack">Microsoft.Linux.UniversalR.1</rec>
    <rec key="deploytestapp">false</rec>
    <rec key="defaultresourcepool">All Management Servers Resource Pool</rec>
    <rec key="localagents"><![CDATA[C:\Program Files\Microsoft System Center 2012 R2\Operations Manager\Server\AgentManagement\UnixAgents\DownloadedKits]]></rec>
    <rec key="remoteagents"><![CDATA[\\scxrel02\ScxCore\MAIN]]></rec>
    <!-- If this is true, ignore the remote agent drop folder, and use only local agents found in the pat given by 'localagents' -->
    <rec key="uselocalagents">true</rec>
    <!-- If this is true, Use "Install/Upgrade Apache CIM Module" task to install apache CIM module, it false, use command to install apache agent. -->
    <rec key="useTaskInstallApacheAgent">false</rec>
    <rec key="apacheAgentPath"><![CDATA[C:\Apache\cimprov]]></rec>
    <rec key="AgentPkgExt">rpm</rec>
    <rec key="DirectoryTag">CENTOS5.0_X64</rec>
    <rec key="latestonly">true</rec>
    <rec key="installonly">false</rec>
    <!--
      Agent maintenance account settings
      1. credentials type: 
         SSHKey = 0, BasicAuth = 1,;
     
      2. type of account: 
         priviledged = 0, unpriviledged = 1  
  
      3. sshkey credential type
         withPassphrase = 0, withoutPassphrase = 1
  
      4. elevated credential type
         None = 0, su = 1, sudo = 2 
     -->
    <rec key="UseAgentMaintenanceAccount">true</rec>
    <rec key="agentcredentialSettings">1,0,0,0</rec>
    <!--
    Performanace Data Collection test Setting
    -->
    <rec key="basetime"></rec>
    <rec key="startrange">-23:59:59</rec>
    <rec key="endrange">23:59:59</rec>
    
    <!--check apache status-->
    <rec key="startApacheCmd">service httpd start</rec>
    <rec key="stopApacheCmd">service httpd stop</rec>
    <rec key="restartApacheCmd">service httpd restart</rec>
    <rec key="checkServiceCmd">service httpd status</rec>
    <varref />
  </grp>
</varmap>
